<!DOCTYPE html>
<html lang="en" style="background-color: lightblue;">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weather App</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>
<body>
  <script src="https://kit.fontawesome.com/8df78e7ae5.js" crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <div id="app" style="background-color: lightblue;">
    <nav class="navbar justify-content-between navbar-dark bg-primary">

      <a class="navbar-brand" style="color:white">      
        <h1>Weather App</h1>
      </a>
      <form class="form-inline">
        <input class="form-control mr-sm-2" type="search" v-model="city" type="text" placeholder="Enter City" aria-label="Search">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit" v-on:click="getInfo" >Search</button>
      </form>
    </nav>

    <div v-if="packingGuide.length != 0" class="weatherinfo">
      <div class="currweather">
        <h1>{{currTemp}}&degC</h1>
        <h2>{{currDescription}}</h1>
      </div>
    
      <div class="weathertable" >
        <h3>Weather for the next 5 days:</h2>
        <table class="table" border="3">
          <tr>
            <th>Date</th>
            <th>Average temperature (&degC)</th>
            <th>Average wind speed (meters/seconds)</th>
            <th>Average rainfall (mm) for 3 hours</th>
          </tr>
          <tr v-for="weather in weatherTable">
            <td>{{weather.date}}</td>
            <td>{{weather.avgTempPerDay}}</td>
            <td>{{weather.avgWindSpeedPerDay}} </td>
            <td>{{weather.avgRainfallPerDay}}</td>
          </tr>
        </table>
      </div>

      <table>
        <tr>
          <td style="padding: 20px;">
      <div class="packingGuide">
        <h3>Packing Guide:</h2>
        <ul>
          <li v-for="guide in packingGuide">{{guide}}</li>
        </ul>
      </div>
    </td>

    <td style="padding: 20px;">
      <div class="card" style="width: 18rem;">
        <div class="card-header">
          Recommended Hotels
        </div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item">
            <a :href="hotelLink[0]">{{hotelList[0]}}</a>
          </li>
          <li class="list-group-item">
            <a :href="hotelLink[1]">{{hotelList[1]}}</a>
          </li>
          <li class="list-group-item">
            <a :href="hotelLink[2]">{{hotelList[2]}}</a>
          </li>
          <li class="list-group-item">
            <a :href="hotelLink[3]">{{hotelList[3]}}</a>
          </li>
          <li class="list-group-item">
            <a :href="hotelLink[4]">{{hotelList[4]}}</a>
          </li>
        </ul>
      </div>
    </td>
    </tr>
    </table>
    </div>
  </div>

  <style lang="css">

    .enterCity input{
      font-size: 30px;
    }
    .enterCity button{
      margin-top: 20px;
    }
    .weatherData{
      margin-top:20px;
    }
    .weatherData h1{
      font-size: 80px;
    }
  
    .weathertable{
      margin-top: 20px;
    }
    .navbar .h1{
      align-items: center;
    }
    .weatherinfo {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .iframe.sad1 , .iframe.sad2{
      display: inline;
    }

  </style>

</body>

<script>

  var app = new Vue({
    el: '#app', 
    data:{
      city: '',
      rain: false, 
      avgTemp: null,
      weatherTable: null,
      currTemp: null,
      currDescription: null, 
      hotelList: [],
      hotelLink: [], 
      packingGuide: [], 
      pollution: null
    }, 
    methods :{
      getInfo: getWeather,

    }
  })

  function getWeather(){
    this.weatherTable = null
    this.packingGuide = []
    fetch('http://127.0.0.1:3000/currweather/' + this.city)
    .then(response => response.json())
    .then(response => {
      this.currTemp = response.temp
      this.currDescription = response.description
    })

    fetch('http://127.0.0.1:3000/weather/' + this.city)
    .then(response => response.json())
    .then(response => {
      // console.log(response)
      this.rain = response.rain
      this.avgTemp = response.avgTemp
      this.weatherTable = response.weatherTable
      if(this.rain){
        this.packingGuide.push("We recommend you to bring an umbrella, rain is awaiting you!")
      }
      if(this.avgTemp<13){
        this.packingGuide.push("We recommend you to bring a jacket, it's going to be cold!")
      }
      else if(this.avgTemp<=23 && this.avgTemp>=13){
        this.packingGuide.push("We recommend you to bring a hat and sunglasses, it's going to be hot!")
      }
    })

    fetch('http://127.0.0.1:3000/pollution/' + this.city)
    .then(response=> response.json())
    .then(response => {
      this.pollution = response.pollution
      if(this.pollution>10){
        this.packingGuide.push("We recommend you to bring a mask, the air is polluted!")
      }
    })

    fetch('http://127.0.0.1:3000/hotels/' + this.city)
    .then(response => response.json())
    .then(response => {
      // console.log(response)
      for(let i =0; i<5; i++) {
        this.hotelList.push(response[i].name)
        let outLink = "https://www.google.com/search?q=" + response[i].name.split(' ').join('+');
        this.hotelLink.push(outLink)
      }

    })
  }

</script>
</html> 


